<?xml version="1.0" encoding="utf-8" ?>
<abstract:EventDetailsPageAbstract
    x:Class="Wino.Calendar.Views.EventDetailsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:abstract="using:Wino.Mail.WinUI.Views.Abstract"
    xmlns:calendar="using:Wino.Core.Domain.Entities.Calendar"
    xmlns:calendarHelpers="using:Wino.Calendar.Helpers"
    xmlns:coreControls="using:Wino.Mail.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:domain="using:Wino.Core.Domain"
    xmlns:enums="using:Wino.Core.Domain.Enums"
    xmlns:helpers="using:Wino.Helpers"
    xmlns:local="using:Wino.Calendar.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Style="{StaticResource PageStyle}"
    mc:Ignorable="d">

    <Page.Resources>
        <Style x:Key="ActionBarElementContainerStackStyle" TargetType="StackPanel">
            <Setter Property="Spacing" Value="6" />
            <Setter Property="Padding" Value="10,0,4,0" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Orientation" Value="Horizontal" />
        </Style>

        <Style TargetType="AppBarElementContainer">
            <Setter Property="VerticalAlignment" Value="Center" />
        </Style>

        <Style x:Key="EventDetailsPanelGridStyle" TargetType="Grid">
            <Setter Property="Padding" Value="0,12" />
            <Setter Property="Margin" Value="12,0" />
        </Style>

        <Style
            x:Key="EventDetailsPanelTitleStyle"
            BasedOn="{StaticResource SubtitleTextBlockStyle}"
            TargetType="TextBlock">
            <Setter Property="FontWeight" Value="Normal" />
            <Setter Property="Margin" Value="0,0,0,20" />
        </Style>
    </Page.Resources>
    <Grid Padding="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  Action Bar  -->
        <Border
            VerticalAlignment="Top"
            Background="{ThemeResource WinoContentZoneBackgroud}"
            BorderBrush="{StaticResource CardStrokeColorDefaultBrush}"
            BorderThickness="1"
            CornerRadius="7">
            <CommandBar
                HorizontalAlignment="Left"
                Background="Transparent"
                DefaultLabelPosition="Right"
                IsSticky="True"
                OverflowButtonVisibility="Auto">
                <AppBarToggleButton
                    x:Name="ReadOnlyToggle"
                    Content="{x:Bind domain:Translator.CalendarEventDetails_ReadOnlyEvent}"
                    IsChecked="True" />
                <AppBarButton Command="{x:Bind ViewModel.SaveCommand}" Label="{x:Bind domain:Translator.Buttons_Save}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Icon="Save" />
                    </AppBarButton.Icon>
                </AppBarButton>
                <AppBarButton Command="{x:Bind ViewModel.DeleteCommand}" Label="{x:Bind domain:Translator.Buttons_Delete}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Icon="Delete" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarSeparator />

                <!--  Join Online  -->
                <AppBarButton
                    Command="{x:Bind ViewModel.JoinOnlineCommand}"
                    IsEnabled="{x:Bind calendarHelpers:CalendarXamlHelpers.HasOnlineMeetingLink(ViewModel.CurrentEvent), Mode=OneWay}"
                    Label="{x:Bind domain:Translator.CalendarEventDetails_JoinOnline}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Icon="EventJoinOnline" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarSeparator />

                <!--  Response Options  -->
                
                <AppBarButton
                    Command="{x:Bind ViewModel.RespondCommand}"
                    CommandParameter="{x:Bind enums:CalendarItemStatus.Confirmed}"
                    Label="{x:Bind domain:Translator.CalendarEventResponse_Accept}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Foreground="#527257" Icon="EventAccept" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.RespondCommand}"
                    CommandParameter="{x:Bind enums:CalendarItemStatus.Tentative}"
                    Label="{x:Bind domain:Translator.CalendarEventResponse_Tentative}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Foreground="#805682" Icon="EventTentative" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarButton
                    Command="{x:Bind ViewModel.RespondCommand}"
                    CommandParameter="{x:Bind enums:CalendarItemStatus.Cancelled}"
                    Label="{x:Bind domain:Translator.CalendarEventResponse_Decline}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Foreground="#805682" Icon="EventRespond" />
                    </AppBarButton.Icon>
                </AppBarButton>

                <AppBarSeparator />

                <!--  Show as  -->
                <AppBarElementContainer>
                    <StackPanel Style="{StaticResource ActionBarElementContainerStackStyle}">
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind domain:Translator.CalendarEventDetails_ShowAs}" />
                        <ComboBox
                            Width="150"
                            ItemsSource="{x:Bind ViewModel.ShowAsOptions}"
                            SelectedItem="{x:Bind ViewModel.SelectedShowAs, Mode=TwoWay}" />
                    </StackPanel>
                </AppBarElementContainer>

                <!--  Reminder  -->
                <AppBarElementContainer>
                    <StackPanel Style="{StaticResource ActionBarElementContainerStackStyle}">
                        <coreControls:WinoFontIcon FontSize="16" Icon="Reminder" />
                        <TextBlock VerticalAlignment="Center" Text="{x:Bind domain:Translator.CalendarEventDetails_Reminder}" />
                        <ComboBox Width="150" />
                    </StackPanel>
                </AppBarElementContainer>

                <AppBarSeparator />

                <!--  Edit Series  -->
                <AppBarButton Label="{x:Bind domain:Translator.CalendarEventDetails_EditSeries}" Visibility="{x:Bind ViewModel.CanEditSeries, Mode=OneWay}">
                    <AppBarButton.Icon>
                        <coreControls:WinoFontIcon Icon="EventEditSeries" />
                    </AppBarButton.Icon>
                </AppBarButton>
            </CommandBar>
        </Border>

        <!--  Event details  -->
        <ScrollViewer Grid.Row="1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="1*" />
                    <ColumnDefinition Width="1*" />
                </Grid.ColumnDefinitions>

                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Details  -->
                <Grid x:Name="DetailsGrid" Style="{StaticResource EventDetailsPanelGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Style="{StaticResource EventDetailsPanelTitleStyle}" Text="{x:Bind domain:Translator.CalendarEventDetails_Details}" />

                    <Grid Grid.Row="1">
                        <!--  Read-Only Event  -->
                        <Grid
                            x:Name="ReadOnlyDetailsGrid"
                            RowSpacing="6"
                            Visibility="{x:Bind ReadOnlyToggle.IsChecked, Mode=OneWay}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="16" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!--  Title  -->
                            <TextBlock
                                Style="{StaticResource SubheaderTextBlockStyle}"
                                Text="{x:Bind ViewModel.CurrentEvent.Title, Mode=OneWay}"
                                TextWrapping="Wrap" />

                            <!--  Date and Duration  -->
                            <TextBlock
                                Grid.Row="2"
                                Text="{x:Bind calendarHelpers:CalendarXamlHelpers.GetEventDetailsDateString(ViewModel.CurrentEvent, ViewModel.CurrentSettings), Mode=OneWay}"
                                TextWrapping="Wrap" />

                            <!--  Recurrence Info  -->
                            <Grid
                                Grid.Row="3"
                                ColumnSpacing="6"
                                Visibility="{x:Bind ViewModel.CurrentEvent.IsRecurringParent}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>

                                <coreControls:WinoFontIcon FontSize="14" Icon="CalendarEventRepeat" />
                                <TextBlock
                                    Grid.Column="1"
                                    VerticalAlignment="Center"
                                    Text="{x:Bind calendarHelpers:CalendarXamlHelpers.GetRecurrenceString(ViewModel.CurrentEvent), Mode=OneWay}"
                                    TextWrapping="Wrap" />
                            </Grid>

                        </Grid>

                        <!--  Editable Event  -->
                        <Grid Visibility="{x:Bind helpers:XamlHelpers.ReverseVisibilityConverter(ReadOnlyDetailsGrid.Visibility), Mode=OneWay}">
                            <TextBlock Text="{x:Bind domain:Translator.CalendarEventDetails_Editing}" />
                        </Grid>
                    </Grid>
                </Grid>

                <!--  People  -->
                <Grid
                    x:Name="PeopleGrid"
                    Grid.Column="1"
                    Style="{StaticResource EventDetailsPanelGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Style="{StaticResource EventDetailsPanelTitleStyle}" Text="{x:Bind domain:Translator.CalendarEventDetails_People}" />

                    <Grid Grid.Row="1" RowSpacing="12">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <AutoSuggestBox
                            Margin="6,0"
                            BorderThickness="0"
                            PlaceholderText="{x:Bind domain:Translator.CalendarEventDetails_InviteSomeone}" />

                        <ListView
                            Grid.Row="1"
                            IsItemClickEnabled="True"
                            ItemsSource="{x:Bind ViewModel.CurrentEvent.Attendees, Mode=OneWay}"
                            SelectionMode="None">
                            <ListView.ItemTemplate>
                                <DataTemplate x:DataType="calendar:CalendarEventAttendee">
                                    <Grid Margin="0,6" ColumnSpacing="12">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <PersonPicture
                                            Width="40"
                                            Height="40"
                                            DisplayName="{x:Bind Name}" />

                                        <!--  TODO: Organizer  -->
                                        <Grid Grid.Column="1">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>

                                            <TextBlock FontWeight="SemiBold" Text="{x:Bind Name}" />
                                            <TextBlock
                                                Grid.Row="1"
                                                FontSize="13"
                                                Text="{x:Bind Email}" />
                                        </Grid>
                                    </Grid>
                                </DataTemplate>
                            </ListView.ItemTemplate>
                        </ListView>
                    </Grid>
                </Grid>

                <!--  Attachments  -->
                <Grid
                    x:Name="AttachmentsGrid"
                    Grid.Column="2"
                    Style="{StaticResource EventDetailsPanelGridStyle}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>

                    <TextBlock Style="{StaticResource EventDetailsPanelTitleStyle}" Text="{x:Bind domain:Translator.CalendarEventDetails_Attachments}" />

                </Grid>
            </Grid>
        </ScrollViewer>
    </Grid>
</abstract:EventDetailsPageAbstract>
